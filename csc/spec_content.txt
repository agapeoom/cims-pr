CSC-단말 연동규격서CSC-단말 연동규격서
CSC-단말 연동규격서
CSC-단말 연동규격서
자료종류 
언어코드
    /
작성
         /
심사
          /
결정
          /
등록일자
Item Code
본 자료는 기술자료 관리 전사 규정 DHQ2-0021K에서 요구한 내용에 따라 작성, 등록, 활용되는 삼성전자 공식 기술자료 입니다.본 자료는 기술자료 관리 전사 규정 DHQ2-0021K에서 요구한 내용에 따라 작성, 등록, 활용되는 삼성전자 공식 기술자료 입니다.
본 자료는 기술자료 관리 전사 규정 DHQ2-0021K에서 요구한 내용에 따라 작성, 등록, 활용되는 삼성전자 공식 기술자료 입니다.
본 자료는 기술자료 관리 전사 규정 DHQ2-0021K에서 요구한 내용에 따라 작성, 등록, 활용되는 삼성전자 공식 기술자료 입니다.
연 혁
수정판
날짜
저자
수정 내용
1.0
2016.11.11
양성모
V1.0 배포
1.1
2016.11.11
양성모
KMS Request Url 수정 및 오자 수정
3.2.1 GMS-UE Signal Flow 설명 수정
Group regroup/teardown flow 삭제
1.2
2016.11.18
양성모
UE Configuration 메시지 포맷 추가
UE Configuration Schema 추가
User Profile Schema V13.2.0 적용
1.3
2016.12.13
양성모
User Profile Schema Hierarchy 변경(Ruleset 추가)
1.4
2017.04.06
양성모
Group creation/delete/update 포맷 삭제
UE Configuration 삭제 (미사용)
KMS 메시지 포맷 보완
1.5
2017.04.07
양성모
전부령
TLS setup 추가 및 일부 내용 보완ㅁ
목차
연 혁2
그림 목차6
도표 목차7
용어 및 약자 정의8
참고 문헌9
1. 개요10
1.1 목적10
1.2 범위10
1.3 문서 구성10
2. 단말기-CSC 연동 개요11
2.1 단말 Interface 정의11
2.2 단말기 부팅 시나리오12
2.3 단말기 Signaling12
3. 단말기-CSC 인터페이스13
3.1 IDMS-UE 인터페이스 (CSC-1)13
3.1.1 Authentication Procedure14
3.1.2 Refresh Token Procedure22
3.1.3 Access Token Validation Procedure26
3.2 GMS-UE 인터페이스 (CSC-2)30
3.2.1 GMS-UE Signal Flow30
3.2.2 GMS-UE 메시지36
3.2.3 GMS-UE 메시지 포맷37
3.3 CMS-UE 인터페이스 (CSC-4)42
3.3.1 CMS-UE Signal Flow42
3.3.2 CMS-UE 메시지43
3.3.3 CMS-UE 메시지 포맷43
3.4 KMS-UE 인터페이스 (CSC-8)48
3.4.1 KMS-UE Signal Flow48
3.4.2 KMS-UE 메시지48
3.4.3 KMS-UE 메시지 포맷49
4. XCAP Examples54
4.1 Document Directory54
4.1.1 일반54
4.1.2 코딩54
4.1.3 Document Directory 획득54
4.2 User profile configuration document55
4.2.1 일반55
4.2.2 코딩55
4.2.3 Document 획득56
4.2.4 Element 생성/교체오류! 책갈피가 정의되어 있지 않습니다.
4.2.5 Element 삭제오류! 책갈피가 정의되어 있지 않습니다.
4.2.6 Element 획득56
4.3 Service configuration document57
4.3.1 일반57
4.3.2 코딩57
4.3.3 Document 획득57
4.3.4 Element 획득57
4.4 Group configuration document58
4.4.1 일반58
4.4.2 코딩58
4.4.3 Document 생성/교체오류! 책갈피가 정의되어 있지 않습니다.
4.4.4 Document 삭제오류! 책갈피가 정의되어 있지 않습니다.
4.4.5 Document 획득58
4.4.6 Element 생성/교체오류! 책갈피가 정의되어 있지 않습니다.
4.4.7 Element 삭제오류! 책갈피가 정의되어 있지 않습니다.
4.4.8 Element 획득60
4.5 Document subscription 및 notification61
4.5.1 일반61
4.5.2 코딩61
4.5.3 Initial Subscription62
4.5.4 Notification64
5. XML schema65
5.1 xcapDirectory65
5.2 resource Lists65
5.3 xdm_extensions65
5.4 rsrclst_uriusage65
5.5 commonPolicy65
5.6 mcpttgi extensions65
5.7 group65
5.8 User profile66
5.9 Service Configuration66
그림 목차
그림 1. Functional model for MCPTT System11
그림 2. 단말기 부팅 시나리오12
그림 3. Authentication Code Flow13
그림 4. Authentication Code Flow14
그림 5. Refresh Token Signal Flow22
그림 6. Access Token Signal Flow26
그림 7. IdMS 인증 및 Token 발행 절차28
그림 8. IdMS Token 재발행 절차29
그림 9. 통화그룹 조회30
그림 10. 통화그룹 생성31
그림 11. 통화그룹 업데이트32
그림 12. 통화그룹 삭제33
그림 13. 통화그룹 멤버 추가34
그림 14. 통화그룹 멤버 삭제35
그림 15. User Profile 검색 Signal Flow42
그림 16. User Profile 업데이트 알림 Signal Flow42
그림 17. Service Configuration 검색 Signal Flow43
그림 18. KMS-UE 간 Signal Flow48
도표 목차
표 1. Authentication Request 메시지 파라미터15
표 2. Authentication Response 메시지 파라미터16
표 3. Authentication Response Error Code16
표 4. Token Request 메시지 파라미터18
표 5. Token Response 메시지 파라미터19
표 6. Token Response Error Code20
표 7. Access Token Request 메시지 파라미터22
표 8. Access Token Error Code24
표 9. GMS-UE 메시지36
표 10. CMS-UE 메시지43
표 11. KMS-UE 메시지48
표 12. KMS certificate response Parameter50
표 13. User key provision response Parameter52
용어 및 약자 정의
약자   설명 
AUIDApplication Unique Identity
CMCConfiguration Management Client
CMSConfiguration Management Server
CSCCommon Services Core
GMCGroup Management Client
GMSGroup Management Server
HTTPHyperText Transfer Protocol
HTTPSHyperText Transfer Protocol Secure
MCPTTMission Critical Push To Talk
MOManagement Object
OMAOpen Mobile Alliance
SIPSession Initiation Protocol
UEUser Equipment 
URIUniform Resource Identifier
XCAPXML Configuration Access Protocol
XDMXML Document Management
XDMCXML Document Management Client
XDMSXML Document Management Server
XMLeXtensible Markup Language
XUIXCAP Unique Identifier
참고 문헌
OMA-TS-XDM_Core-V2_1-20120403-A: "XML Document Management (XDM) Specification"
OMA-TS-XDM_Group-V1_1-20120403-A: "Group XDM Specification"
3GPP TS 22.179: “Mission Critical Push to Talk (MCPTT) over LTE”; Stage 1.
3GPP TS 23.179: “Functional architecture and information flows to support mission critical communication services”.
3GPP TS 24.379: “Mission Critical Push to Talk (MCPTT) call control; Protocol Specification
3GPP TS 24.381: “Mission Critical Push to Talk (MCPTT) group management; Protocol Specification
3GPP TS 24.382: “Mission Critical Push to Talk (MCPTT) identity management; Protocol Specification
3GPP TS 24.383: “Mission Critical Push to Talk (MCPTT) Management Object(MO)
3GPP TS 24.384: “Mission Critical Push to Talk (MCPTT) configuration management; Protocol Specification
3GPP TS 29.283: "Diameter Data Management Applications"
3GPP TS 33.179: “Security of Mission Critical Push-To-Talk (MCPTT) over LTE”
IETF RFC 5875: "An Extensible Markup Language (XML) Configuration Access Protocol (XCAP) Diff Event Package"
IETF RFC 4825: "The Extensible Markup Language (XML) Configuration Access Protocol (XCAP)"
1. 개요
본 문서는 단말기와 Common Services Core (이하 “CSC”라 명칭 통일) 서버와의 연동 규격서로서 3GPP MCPTT 규격서를 기반으로 단말기와 CSC 간의 연동 사항을 기술한다.
1.1 목적
본 문서는 단말기와 CSC의 연동 규격을 기술함으로 해서 단말기 개발자들이CSC와의 통신 인터페이스 규격을 알고 통일화 시키기 위하여 작성되었다.
이 문서는 다음의 관련자들이 꼭 참고하여야 한다.
-  단말기 개발자
1.2 범위
본 시스템의 연동 범위는 단말기와 CSC 간의 연동 인터페이스를 정의하며, 본 연동 규격서는 각 인터페이스에서 사용되는 기능별 XCAP을 서술한다. 여러 표준규격에 명시된 기술사항은 제외하고 순수 CSC 연동에 필요한 필수사항 및 참고하기 쉽도록 Example 위주로 서술되었다.
1.3 문서 구성
본 문서는 CSC와 연동하기 위한 Interface, XCAP Example, XML Schema를 서술한다.
2. 단말기-CSC 연동 개요
2.1 단말 Interface 정의
UEUE
UE
UE
그림 1. Functional model for MCPTT System그림 1. Functional model for MCPTT System
그림 1. Functional model for MCPTT System
그림 1. Functional model for MCPTT System
[Note] 원강선의 경우, HTTP Proxy 는 존재하지 않고, UE 와 CSC 서버 사이에 HTTPS 를 사용한다.
CSC-1은 단말과 CSC의 Identity management server와의 인터페이스로 사용자 Id 및 인증정보를 취급한다. [HTTPS]
CSC-2은 단말과 CSC의 Group management server와의 인터페이스로 그룹정보를 취급한다. [HTTPS, SIP]
CSC-4는 단말기와 CSC의 Configuration management server와의 인터페이스로 사용자정보를 취급한다. [HTTPS, SIP]
CSC-8은 단말기와 CSC의 Key management server의 인터페이스로 Key정보를 취급한다. [HTTPS]
2.2 단말기 부팅 시나리오
그림 2. 단말기 부팅 시나리오
단말기는 CSC의 IdMS의 ID와 Password로 로그인 한다.
단말기는 CSC의 CMS에서 UE Configuration을 가져온다.
단말기는 CSC의 GMS에서 Group Configuration을 가져온다.
단말기는 CSC의 KMS에서 Key Material을 가져온다.
2.3 단말기 Signaling
항목
Signaling
설명
1
HTTP/HTTPS
Key provisioning & management
Configuration access & management
2
SIP
Subscription & Notification
3
etc.
-
3. 단말기-CSC 인터페이스
3.0 TLS setup
[Note] CSC의 HTTPS용 Server Port는 4420이다.
HTTPS is used between UE and CSC. Figure below explains the TLS establishment procedure between an MCPTT UE and the CSC server.
그림 3. Authentication Code Flow
Elements between square brackets are optional. Server key exchange may be required according to the cipher selected, other elements are used to generate a ticket to the MCPTT UE. This ticket can be reused in further TLS sessions establishment to speed up the procedure. This feature is called TLS session caching. The server stores its session state to the ticket that is encrypted and integrity-protected. The MCPTT UE caches this ticket with other cryptographic information. When the server receives the ticket, it checks whether it is still valid and can resume the TLS session by retrieving the session state from the ticket.
At Step3, the MCPTT UE checks the validity of the certificate provided by the server. If it is not valid, the session is aborted.
3.1 IDMS-UE 인터페이스 (CSC-1)
CSC-1 인터페이스는 CSC의 IdMS 서버와 UE간의 Authentication 절차를 수행하기 위한 연동 인터페이스를 정의한다. IdMS의 주요 기능은 다음과 같다.
Client (MCPTT UE)로부터 인증 요청을 받아서 ID Token, Refresh Token, Access Token을 발급한다.
Access Token 유효기간 만료 시 Refresh Token을 받아 Access Token을 재 발행하는 기능을 수행한다.
3.1.1 Authentication Procedure
단말은 IdMS와의 통신은 HTTP를 지원하지 않으며, HTTPS 세션만을 허용한다.
MCPTT UEIdMSMCPTT UE는 IdMS에 사전에 등록되어 Client Id와  Client Secret을 발급 받은 상태임HTTPS GET: Authentication Request(client_id, code_challenge, user_name, user_password)HTTPS 200 OK: Authentication Response (Auth-code) ResponseHTTPS POST:  Token Request (Auth-code, code_verifier)HTTPS 200 OK: Token Response (ID token, Access Token, Refresh Token)AuthenticationToken Req/RespMCPTT UEIdMSMCPTT UE는 IdMS에 사전에 등록되어 Client Id와  Client Secret을 발급 받은 상태임HTTPS GET: Authentication Request(client_id, code_challenge, user_name, user_password)HTTPS 200 OK: Authentication Response (Auth-code) ResponseHTTPS POST:  Token Request (Auth-code, code_verifier)HTTPS 200 OK: Token Response (ID token, Access Token, Refresh Token)AuthenticationToken Req/Resp
MCPTT UE
IdMS
MCPTT UE는 IdMS에 사전에 등록되어 Client Id와  Client Secret을 발급 받은 상태임
HTTPS GET: Authentication Request
(client_id, code_challenge, user_name, user_password)
HTTPS 200 OK: Authentication Response (Auth-code) Response
HTTPS POST:  Token Request (Auth-code, code_verifier)
HTTPS 200 OK: Token Response (ID token, Access Token, Refresh Token)
Authentication
Token Req/Resp
MCPTT UE
IdMS
MCPTT UE는 IdMS에 사전에 등록되어 Client Id와  Client Secret을 발급 받은 상태임
HTTPS GET: Authentication Request
(client_id, code_challenge, user_name, user_password)
HTTPS 200 OK: Authentication Response (Auth-code) Response
HTTPS POST:  Token Request (Auth-code, code_verifier)
HTTPS 200 OK: Token Response (ID token, Access Token, Refresh Token)
Authentication
Token Req/Resp
그림 4. Authentication Code Flow
3.1.1.1 Authentication Request Message
Request Message
GET /idms/authreq?<response_type><client_id><scope><redirect_uri><state><acr_values><code_challenge><code_challenge_method> HTTP/1.1
표 1. Authentication Request 메시지 파라미터
Parameter
Values
response_type
"code".
client_id
IdMS에 미리 정의된 id
scope
“openid” (Openid Connect mandatory)"3gpp:mcptt:ptt_server" (service authorization)
“3gpp:mcptt:key_management_server" (key management authorization)
"3gpp:mcptt:config_management_server" (config mgmt authorization)
"3gpp:mcptt:group_management_server" (group mgmt authorization)
redirect_uri
state
MITM(Man in the Middle)공격을 막기위해 Client가 IdMS로 전송하는 임의의 문자열, Response에 동일한 문자열이 채워진다.
acr_values
"3gpp:acr:password".
code_challenge
Code verifier로부터 code_challenge_method에서 지정하는 방식(S256 - The base64url-encoded SHA-256) 방식으로 생성된 코드.  
code_challenge_method
"S256" (code verifier부터 code_challenge 생성하는 방식 명시, 현재 S256으로 고정)
user_name
MCPTT ID를 채운다.
user_password
SHA256방식으로 암호화된 패스워드를 채운다.
Authentication Request Sample
GET /idms/authreq?acr_values=3gpp%3Aacr%3Apassword&state=abcdef&redirect_uri=http%3A%2F%2Fmcptt_client%2Fcb&response_type=code&client_id=MCPTT_UE&user_name=tel%3A%2B82571009990&scope=openid%25203gpp%3Amcptt%3Aptt_server&user_password=FN2_tPfNzuemOaMjnL5UxizwNdx_aDE-faQ_xTNzhhk&code_challenge_method=S256&code_challange=YjExNDI3YzBkYWYwZTUwNDlmZjUyNGViZDY3MGU2YWZiMTQ4Y2RiZGJhNWZmOTg4NWZkNjY1NDA2ZTMyYzRlYw HTTP/1.1
Host: 10.121.2.90:4430 
Connection: keep-alive 
Accept-Encoding: gzip, deflate 
Accept: */* 
User-Agent: python-requests/2.12.1 
Content-Type: application/json; charset=utf-8 
3.1.1.2 Authentication Response Message
Response Message
<code><state> [<error>< error_description>]
표 2. Authentication Response 메시지 파라미터
Parameter
Values
code
IdMS로부터 반환 받은 Auth-code
state
Authentication request할 때 IdMS로 보냈던 state문자열
Successful Response
HTTP/1.1 200 OK 
Pragma: No-cache 
Cache-Control: no-store 
Set-Cookie: JSESSIONID=BDEA55DA0D03CFBC0C579EB6DA8D2BB7; Path=/; HttpOnly 
Content-Type: application/json;charset=UTF-8 
Content-Length: 123 
Date: Thu, 06 Apr 2017 06:15:27 GMT 
Server: CSCI
{
"Location":"http://mcptt_client/cb","code":"_6ggPJ8xdK8hm2OmaJB7b5fQFVG0azuRi_nAg16cBNw","state":"Dispacher_statecode" 
}
Failed Response
HTTP/1.1 302 Found Location:http://mcptt_client/cb? code=&error=unauthorized_client&error_description= uregistered_client_id&state=abcdefg
표 3. Authentication Response Error Code
error
error_description
설명
unauthorized_client
uregistered_client_d
등록되지 않은 client id일 경우
invalid_scope
uknown_scope, not_permitted_scope
요청한 scope가 등록되어 있지 않거나, 판단할 수 없는 경우
invalid_request
invalid_parameter
Authentication request 메시지 내에 필수 파라미터가 채워지지 않은 경우
auth_fail
pssword_is_not_matched
user_name과 user_password로 인증이 실패한 경우
server_error
Internal_server_error
IdMS서버 내부의 문제로 인증을 할 수 없는 경우
※ RFC 6749 4.1.2.1 Error Response 참조
3.1.1.3 Token Request Message
Request Message
POST /idms/tokenreq  HTTP/1.1
Content-Type: application/x-www-form-urlencoded
<response_type><client_id><scope><redirect_uri><state><acr_values><code_challenge><code_challenge_method>
표 4. Token Request 메시지 파라미터
Parameter
Values
grant_type
"authorization_code"  (고정)
code
Authentication response에서 받은 Auth-code
client_id
사전 IdMS에 등록 시 부여받은 id
redirect_uri
authorization request  요청시 사용했던 "redirect_uri" 와 동일한 값.
code_verifier
code_challenge를 유도해 낼 수 있는 소스 값
Token Request Message Sample
POST /idms/tokenreq?code=jbNrz4mGVr86gUXRvH0oI2IAPDAKjaDot_oeHC90KwU&code_verifier=1234567&grant_type=authorization_code&client_id=MCPTT_UE&redirect_uri=http%3A%2F%2Fmcptt_client%2Fcb HTTP/1.1 
Host: 10.121.2.90:4430 
Connection: keep-alive 
Accept-Encoding: gzip, deflate 
Accept: */* 
User-Agent: python-requests/2.12.1 
Content-Type: application/x-www-form-urlencoded 
Cookie: JSESSIONID=10C05AFA6C74885443BDC704EE4B1B86 
Content-Length: 0 
※ token Request 메시지의 유효성 검사는 code_verifier 값을 Authentication req 메시지상의 code_challenge_method에 선언된 방식에 따라 code_challenge가 생성되는지, code_challenge 값으로 auth-code가 유도되는지를 확인하는 방식으로 이뤄진다.
3.1.1.4 Token Response Message 
Response  Message 
<access_token><token_type><refresh_token><expire_in><id_token>
표 5. Token Response 메시지 파라미터
Parameter
Values
access_token
Resoure Server에 접근권한을 증명하는 token
refresh_token
Access token이 expire되기 전에 유효기간을 연장하기 위한 token
id_token
Client(MCPTT_UE)가 Token Response 의 유효성을 증명하기 위한 token
token_type
“Bearer”
expires_in
Token 유효기간, sec (발행시간 기준)
Successful Response
HTTPS/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache
{
"access_token":"eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDo1OTk5OTAwMTEiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0NzUzODA2NzMsInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.gBATCXikTxPcP83QplU7S5r2YSMCmOlA08e8TUDRrPzTx3SmjTYB-Q4hNlnmqkv-041DAhKmCMFCkgt59UFeiGoo0jna1QO5L0gGXTef8hZ_0RkC5z75LckyMV2CNiQDzL0YP1bsXpZsQmZvGQF4RcEguCtfSRq2WrlL9wLteLk_5s5dqGH6kXMJ4yV8suPHlV_a12qh-rn81eubVATZUUtW50DjsFDKvYVi3vlUpY2dM2RepqxzBQh8wPa2Fg2nOZniVdoopLmcNQbxKEFjsp6xCpHfeOT8ZqCYBtItLHjT0KG3Nc6wvSXwke3yPmoTBP4zERqMWIwKKG7bHFdPMQ"
,"refresh_token":"vgJo1hj2xrdiLNgSeUglxuyvTMlEZXF4Id174mC66Kg"
,"id_token":"eyJhbGciOiJIUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDo1OTk5OTAwMTEiLCJpc3MiOiJpZG1zLm1jcHR0LmNvbSIsInN1YiI6ImFFZmRBMVF1WGplUGk3bmhCZnR3VFlGMWtLLXJrMUQtNFFnb2QwOTMzUzAiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0NzUyMTMyNTQsImlhdCI6MTQ3NTIwOTY1NH0.UgQPsZfa0euOwduHCewhZXJ8KVBUF8uHcFj4x4RBMbU"
,"token_type":"Bearer"
,"expires_in":7201
}
Failed Response
HTTPS /1.1 400 Bad RequestContent-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache
{
     "error":"invalid_client"
}
표 6. Token Response Error Code
error string
error_description
설명
invalid_client
authcode_verification_failed
Code-verifier를 가지고 auth-code 검증 시, 검증 실패한 경우
invalid_request
invalid_parameter
Token request 메시지 내에 필수 파라미터가 채워지지 않은 경우
unsupported_grant_type
authorization_code_only
지원하지 않는 grant_type일 경우 (“authorization_code” 만 지원함)
※ RFC 6749 5.2 Error Response 참조
ID Token sample
“eyJhbGciOiJIUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDo1OTk5OTAwMTEiLCJpc3MiOiJpZG1zLm1jcHR0LmNvbSIsInN1YiI6ImFFZmRBMVF1WGplUGk3bmhCZnR3VFlGMWtLLXJrMUQtNFFnb2QwOTMzUzAiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0NzUyMTMyNTQsImlhdCI6MTQ3NTIwOTY1NH0.UgQPsZfa0euOwduHCewhZXJ8KVBUF8uHcFj4x4RBMbU”
Header = { "alg": "RS256" }
PAYLOAD = {
  "mcptt_id": "tel:+82510200011",
  "iss": "idms.mcptt.com",
  "sub": "aEfdA1QuXjePi7nhBftwTYF1kK-rk1D-4Qgod0933S0",
  "aud": "mcptt_client",
  "exp": 1475213254,
  "iat": 1475209654
}
※ id token의 Signature Validation 검사는 client secret으로 가능하다.
Access Token sample
“eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDo1OTk5OTAwMTEiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0NzUzODA2NzMsInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.gBATCXikTxPcP83QplU7S5r2YSMCmOlA08e8TUDRrPzTx3SmjTYB-Q4hNlnmqkv-041DAhKmCMFCkgt59UFeiGoo0jna1QO5L0gGXTef8hZ_0RkC5z75LckyMV2CNiQDzL0YP1bsXpZsQmZvGQF4RcEguCtfSRq2WrlL9wLteLk_5s5dqGH6kXMJ4yV8suPHlV_a12qh-rn81eubVATZUUtW50DjsFDKvYVi3vlUpY2dM2RepqxzBQh8wPa2Fg2nOZniVdoopLmcNQbxKEFjsp6xCpHfeOT8ZqCYBtItLHjT0KG3Nc6wvSXwke3yPmoTBP4zERqMWIwKKG7bHFdPMQ”
Header = { "alg": "RS256" }
PAYLOAD = {
  "mcptt_id": "tel:+82510200011",
  "aud": "mcptt_client",
  "exp": 1475380673,
  "scope": [
    "openid",
    "3gpp:mcptt:ptt_server"
  ]
}
※ access token의 Signature Validation 검사는 IdMS의 Public key로 가능하다.
3.1.2 Refresh Token Procedure
Refresh Token 처리는 Token의 사용기간이 만료 되었을 경우 Token을 갱신하기 위한 처리 절차이다.
MCPTT UEIdMSHTTPS POST, Access token request (refresh_token, scope)HTTPS 200 OK, Access token response (refresh_token, access_token)MCPTT UEIdMSHTTPS POST, Access token request (refresh_token, scope)HTTPS 200 OK, Access token response (refresh_token, access_token)
MCPTT UE
IdMS
HTTPS POST, Access token request (refresh_token, scope)
HTTPS 200 OK, Access token response (refresh_token, access_token)
MCPTT UE
IdMS
HTTPS POST, Access token request (refresh_token, scope)
HTTPS 200 OK, Access token response (refresh_token, access_token)
그림 5. Refresh Token Signal Flow
Refresh_token 사용시기 
Resource  서버(KMS,CMS,GMS,MCPTT...)에 access token을 가지고 요청을 하였을 때, access token이 만료되었다는 메시지(401 Unauthorized, error="invalid_token")를 받는 경우
Access token 만료
 Access_token 내에 exp 항목을 기준으로 만료 여부를 판단한다. exp 항목을 임의로 변경시  validation 체크하는 과정에서 token이 무효 처리됨으로 변경 불가하다.
Refresh_token 만료 
 Refresh_token내에 exp항목을 기준으로 만료 여부를 판단하며, 토큰이 만료된 경우, MCPTT UE는 IdMS로부터 다시 인증을 받는 Flow를 거쳐야 한다.
3.1.2.1 Access token request Message
Request  Message 
POST  /idms/ tokenrefresh 
<grant_type><refresh_token><scope>
표 7. Access Token Request 메시지 파라미터
Parameter
Values
grant_type
"refresh_token".
scope
authorization request 당시에 요청했던 scope와 동일하거나 더 작은 scope가 허용된다.
refresh_token
Token response에서 수신 받았던 token과 동일한 token
Request Message Sample
POST /idms/tokenrefresh  HTTP/1.1
Cache-Control: no-cacheContent-Type: application/x-www-form-urlencodedgrant_type=refresh_token&refresh_token= vgJo1hj2xrdiLNgSeUglxuyvTMlEZXF4Id174mC66Kg &scope=openid 3gpp:mcptt:ptt_server
3.1.2.2 Access token response Message
Response  Message 
<access_token><refresh_token><token_type><expires_in>
Successful Response Message
HTTPS/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache
{
"access_token":"eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDo1OTk5OTAwMTEiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0NzUzODM2NzksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.geOFagjQ8OHemHKu6v11pBC8h1TfFxaaZRwcPl--zszvHR-nP36khnTpjebQ2EMHaz8VsyqHmlB3SctR86t3hjUvJN5eUDxjQO4SzgVHVZTVrlGWgPXcwnBuwl0uS3yZlWcinZ_Hjc5I9m0s0OWD9wo7hwyRadjpXZgelHH_akfixJq8k2Z6Phal5K1j1Nrr1kvh5YWa_aYDZfY0EPmMiMmw2Ept2hu4ZSkAnoIa6DoMTd1CQSaHB66Zo5ykjVQnK7RU-TjF-C9uVIcTWhsa2e_YaRzOzXIGLd50OaZ9Kw_JGCPLz2wHnDDX8nFdyQCadlAqcwk4CECmnANLxtVaWg"
,"refresh_token":"rgA9Xdm18Amw9E0tSY6gf1eGY3LuhHW7L-WcxecMI_s"
,"token_type":"Bearer"
,"expires_in":7201
}
Failed Response Message (Refresh token이 만료되거나 일치하는 token이 없을 경우)
HTTP/1.1 400 Bad RequestContent-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache
{
"error":"invalid_client","error_description":"refresh_token_is_expired"
}
표 8. Access Token Error Code
error string
error_description
설명
invalid_client
refresh_token_is_expiredinvalid_refresh_token
Refresh token이 유효하지 않은 경우
invalid_request
invalid_parameter
Token request 메시지 내에 필수 파라미터가 채워지지 않은 경우
Invalid_scope
uknown_scope, not_permitted_scope
요청한 scope가 허용된 범위를 벗어나거나, 판별 불가능 한 경우 
unsupported_grant_type
authorization_code_only
지원하지 않는 grant_type일 경우 (“authorization_cod” 만 지원함)
※ RFC 6749 5.2 Error Response 참조
3.1.3 Access Token Validation Procedure
Access Token Validation은 단말이 CMS/GMS/KMS 및 MCPTT Server에 HTTP 메시지를 보낼 때 Token과 함께 보내어 유효한 메시지인지 확인 받아야 하는 처리 절차를 정의한다.
MCPTT UECMS/GMS/KMS/MCPTT ServerHTTP GET/PUT/POST with Access Token사전에 공유된 IdMS의 Public key를 이용하여 Access Token의 유효성을 검사한다.HTTP ResponseAccess token 내의 scope에 해당하는지 검사MCPTT UE 요청 수행MCPTT UECMS/GMS/KMS/MCPTT ServerHTTP GET/PUT/POST with Access Token사전에 공유된 IdMS의 Public key를 이용하여 Access Token의 유효성을 검사한다.HTTP ResponseAccess token 내의 scope에 해당하는지 검사MCPTT UE 요청 수행
MCPTT UE
CMS/GMS/KMS/MCPTT Server
HTTP GET/PUT/POST with Access Token
사전에 공유된 IdMS의 Public key를 이용하여 Access Token의 유효성을 검사한다.
HTTP Response
Access token 내의 scope에 해당하는지 검사
MCPTT UE 요청 수행
MCPTT UE
CMS/GMS/KMS/MCPTT Server
HTTP GET/PUT/POST with Access Token
사전에 공유된 IdMS의 Public key를 이용하여 Access Token의 유효성을 검사한다.
HTTP Response
Access token 내의 scope에 해당하는지 검사
MCPTT UE 요청 수행
그림 6. Access Token Signal Flow
Access Token이 만료되거나, 서명이 일치하지 않거나, 허용되지 않은 scope(접근 권한)일 경우 다음과 같은 401 응답이 발생한다.
3.1.3.1 HTTP Response Message
Failed Response Message (Access Token이 만료되거나 유효하지 않는 경우)
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer realm=””
error="invalid_token",error_description="access_token_is_expired "
Error 코드 (RFC 6750.txt 6.2.2)
error string
error_description
설명
invalid_token
access_token_is_expiredinvalid_access_token
Access token이 유효하지 않은 경우
invalid_request
invalid_parameter
Token request 메시지 내에 필수 파라미터가 채워지지 않은 경우
Invalid_scope 또는 insufficient_scope
uknown_scope, not_permitted_scope
요청한 scope가 허용된 범위를 벗어나거나, 판별 불가능 한 경우 
※ RFC 6750 6.2.2장 참조
3.1.3.2  인증 및 토큰 발행 절차
HTTPS GET: Authentication Request (client id, code challenge, user_name, user_passwd)Code_challenge에 기초를 둔Auth-code를 생성HTTPS 302 Found, Authentication Response (Auth-code)HTTPS POST:  Token Request (Auth-code, code_verifier)ID Token을 생성하고 Client secret로 서명한다. Refresh Token을 생성한다. Access Token을 생성하고 Private Key로 서명한다. HTTPS 200 OK, Token Response (ID token, Access Token, Refresh Token)MCPTT UEIdMSIs Registered ClientNoHTTPS 302 Found, “unauthorized_client”YesHTTPS 302 Found, “auth_fail”Check Id & PasswdNoYesCode Verify with Auth-code, code_verifierHTTPS 400 Bad, “invalid_request”NoYesHTTPS GET: Authentication Request (client id, code challenge, user_name, user_passwd)Code_challenge에 기초를 둔Auth-code를 생성HTTPS 302 Found, Authentication Response (Auth-code)HTTPS POST:  Token Request (Auth-code, code_verifier)ID Token을 생성하고 Client secret로 서명한다. Refresh Token을 생성한다. Access Token을 생성하고 Private Key로 서명한다. HTTPS 200 OK, Token Response (ID token, Access Token, Refresh Token)MCPTT UEIdMSIs Registered ClientNoHTTPS 302 Found, “unauthorized_client”YesHTTPS 302 Found, “auth_fail”Check Id & PasswdNoYesCode Verify with Auth-code, code_verifierHTTPS 400 Bad, “invalid_request”NoYes
HTTPS GET: Authentication Request (client id, code challenge, user_name, user_passwd)
Code_challenge에 기초를 둔Auth-code를 생성
HTTPS 302 Found, Authentication Response (Auth-code)
HTTPS POST:  Token Request (Auth-code, code_verifier)
ID Token을 생성하고 Client secret로 서명한다. 
Refresh Token을 생성한다. 
Access Token을 생성하고 Private Key로 서명한다. 
HTTPS 200 OK, Token Response (ID token, Access Token, Refresh Token)
MCPTT UE
IdMS
Is Registered Client
No
HTTPS 302 Found, “unauthorized_client”
Yes
HTTPS 302 Found, “auth_fail”
Check Id & Passwd
No
Yes
Code Verify with Auth-code, code_verifier
HTTPS 400 Bad, “invalid_request”
No
Yes
HTTPS GET: Authentication Request (client id, code challenge, user_name, user_passwd)
Code_challenge에 기초를 둔Auth-code를 생성
HTTPS 302 Found, Authentication Response (Auth-code)
HTTPS POST:  Token Request (Auth-code, code_verifier)
ID Token을 생성하고 Client secret로 서명한다. 
Refresh Token을 생성한다. 
Access Token을 생성하고 Private Key로 서명한다. 
HTTPS 200 OK, Token Response (ID token, Access Token, Refresh Token)
MCPTT UE
IdMS
Is Registered Client
No
HTTPS 302 Found, “unauthorized_client”
Yes
HTTPS 302 Found, “auth_fail”
Check Id & Passwd
No
Yes
Code Verify with Auth-code, code_verifier
HTTPS 400 Bad, “invalid_request”
No
Yes
그림 7. IdMS 인증 및 Token 발행 절차
3.1.3.3 토큰 재 발행 절차
MCPTT UEIdMSDatabaseHTTPS GET Access token request (refresh_token, scope)HTTPS 200 OK, Access token response (refresh_token, access_token)New Access Token 생성New Refresh Token 생성Query refresh_tokenUpdate refresh_tokenIs Valid Refresh-TokenHTTPS 400 Bad, “invalid_request”NoYesMCPTT UEIdMSDatabaseHTTPS GET Access token request (refresh_token, scope)HTTPS 200 OK, Access token response (refresh_token, access_token)New Access Token 생성New Refresh Token 생성Query refresh_tokenUpdate refresh_tokenIs Valid Refresh-TokenHTTPS 400 Bad, “invalid_request”NoYes
MCPTT UE
IdMS
Database
HTTPS GET Access token request (refresh_token, scope)
HTTPS 200 OK, Access token response (refresh_token, access_token)
New Access Token 생성
New Refresh Token 생성
Query refresh_token
Update refresh_token
Is Valid Refresh-Token
HTTPS 400 Bad, “invalid_request”
No
Yes
MCPTT UE
IdMS
Database
HTTPS GET Access token request (refresh_token, scope)
HTTPS 200 OK, Access token response (refresh_token, access_token)
New Access Token 생성
New Refresh Token 생성
Query refresh_token
Update refresh_token
Is Valid Refresh-Token
HTTPS 400 Bad, “invalid_request”
No
Yes
그림 8. IdMS Token 재발행 절차
3.2 GMS-UE 인터페이스 (CSC-2)
3.2.1 GMS-UE Signal Flow
3.2.1.1 통화그룹 조회(Group retrieval)
- MCPTT UE 로 부터 그룹정보 요청 받아 그룹의 정보를 전달한다.
GMS지령서버MCPTT UE1(group member)1. Group retrieval request (HTTP GET)2. Find and Deliver  the group related information3. Group retrieval response (HTTP 200 OK)CSCFMCPTT ServerGMS지령서버MCPTT UE1(group member)1. Group retrieval request (HTTP GET)2. Find and Deliver  the group related information3. Group retrieval response (HTTP 200 OK)CSCFMCPTT Server
GMS
지령서버
MCPTT UE1
(group member)
1. Group retrieval request (HTTP GET)
2. Find and Deliver  the group related information
3. Group retrieval response (HTTP 200 OK)
CSCF
MCPTT Server
GMS
지령서버
MCPTT UE1
(group member)
1. Group retrieval request (HTTP GET)
2. Find and Deliver  the group related information
3. Group retrieval response (HTTP 200 OK)
CSCF
MCPTT Server
그림 9. 통화그룹 조회
GMS는 MCPTT UE로부터 그룹 정보 조회를 요청 받는다. 
유효한 그룹인지를 검사하며, 그룹 관련 정보를 UE로 전달한다.
3.2.1.2 통화그룹 생성 (Group Creation) 알림
- 가입자는 Registration 시, Group document 변경에 대한 Subscription 을 수행한 상태로 가정한다.
- CSC가지령서버로 부터 그룹 생성 요청을 받아 그룹을 생성되면, Group 멤버로 등록된 가입자들에게 Group 변경에 대한 NOTIFY 메시지를 전송하여, 단말에게 그룹이 생성되었음을 알려준다.
1. Group creation request (HTTP PUT)2. Create and store the group related information3. Notify group creation (SIP)5. Group creation response (HTTP 201 Created)GMS지령서버MCPTT UE1(group member)4a. Notify group creation (SIP)CSCFMCPTT Server4b. 200 OK (SIP Notify)1. Group creation request (HTTP PUT)2. Create and store the group related information3. Notify group creation (SIP)5. Group creation response (HTTP 201 Created)GMS지령서버MCPTT UE1(group member)4a. Notify group creation (SIP)CSCFMCPTT Server4b. 200 OK (SIP Notify)
1. Group creation request (HTTP PUT)
2. Create and store the group related information
3. Notify group creation (SIP)
5. Group creation response (HTTP 201 Created)
GMS
지령서버
MCPTT UE1
(group member)
4a. Notify group creation (SIP)
CSCF
MCPTT Server
4b. 200 OK (SIP Notify)
1. Group creation request (HTTP PUT)
2. Create and store the group related information
3. Notify group creation (SIP)
5. Group creation response (HTTP 201 Created)
GMS
지령서버
MCPTT UE1
(group member)
4a. Notify group creation (SIP)
CSCF
MCPTT Server
4b. 200 OK (SIP Notify)
그림 10. 통화그룹 생성
GMS는 지령서버로부터 그룹 생성을 요청 받는다. 
유효한 그룹인지를 검사하며, 그룹 생성 및 그룹 관련 정보를 저장한다.
유효한 그룹일 경우, MCPTT Server로 그룹 생성에 대한 Notify를 보낸다.
유효한 그룹일 경우, MCPTT UE로 그룹 생성에 대한 Notify를 보내고, 단말은 200 OK 를 보낸다. 단말은 생성된 그룹 정보를 HTTP GET 을 통해 정보를 조회할 수 있다.
지령서버로 그룹 생성에 대한 결과를 보낸다.
통화그룹 업데이트 (Group update) 알림
- 가입자는 Registration 시, Group document 변경에 대한 Subscription 을 수행한 상태로 가정한다.
- CSC는 지령서버로부터 그룹 업데이트 요청을 받아 그룹의 정보를 업데이트하고, Group의 정보가 변경되었음을 NOTIFY 메시지로 UE에 전달한다.
4b. 200 OK (SIP Notify)4b. 200 OK (SIP Notify)1. Group update request (HTTP PUT)2. Update the group related information3. Notify Group update (SIP)5. Group update response (HTTP 200 OK)GMSAdministratorAuthorized userDispatcherMCPTT UE1(group member)4a. Notify group update (SIP)CSCFMCPTT Server1. Group update request (HTTP PUT)2. Update the group related information3. Notify Group update (SIP)5. Group update response (HTTP 200 OK)GMSAdministratorAuthorized userDispatcherMCPTT UE1(group member)4a. Notify group update (SIP)CSCFMCPTT Server
4b. 200 OK (SIP Notify)
4b. 200 OK (SIP Notify)
1. Group update request (HTTP PUT)
2. Update the group related information
3. Notify Group update (SIP)
5. Group update response (HTTP 200 OK)
GMS
Administrator
Authorized user
Dispatcher
MCPTT UE1
(group member)
4a. Notify group update (SIP)
CSCF
MCPTT Server
1. Group update request (HTTP PUT)
2. Update the group related information
3. Notify Group update (SIP)
5. Group update response (HTTP 200 OK)
GMS
Administrator
Authorized user
Dispatcher
MCPTT UE1
(group member)
4a. Notify group update (SIP)
CSCF
MCPTT Server
그림 11. 통화그룹 업데이트
GMS는 지령서버로부터 그룹 업데이트를 요청 받는다.
유효한 그룹인지를 검사하며, 그룹 업데이트 및 그룹 관련 정보를 저장한다.
변경이 정상적으로 수행된 경우, MCPTT Server로 그룹 정보가 변경에 대한 Notify를 보낸다.
변경이 정상적으로 수행된 경우, MCPTT UE로 그룹 정보 변경에 대한 Notify를 보내고, 단말은 200 OK 를 보낸다. 단말은 생성된 그룹 정보를 HTTP GET 을 통해 정보를 조회할 수 있다.
지령서버로 그룹 정보 변경에 대한 결과를 보낸다
3.2.1.4 통화그룹 삭제 (Group deletion) 알림
- 가입자는 Registration 시, Group document 변경에 대한 Subscription 을 수행한 상태로 가정한다.
- 지령서버로부터 그룹 삭제 요청을 받아 그룹을 삭제한다.
4b. 200 OK (SIP Notify)4b. 200 OK (SIP Notify)1. Group deletion request (HTTP DELETE)2. Delete the group related information3. Notify group deletion (SIP)5. Group deletion response (HTTP 200 OK)GMS지령서버MCPTT UE1(group member)4a. Notify group deletion (SIP)a. If active group call exist, release group callb. Group call release requestc. Notify Userd. Group call release responseCSCFMCPTT Server1. Group deletion request (HTTP DELETE)2. Delete the group related information3. Notify group deletion (SIP)5. Group deletion response (HTTP 200 OK)GMS지령서버MCPTT UE1(group member)4a. Notify group deletion (SIP)a. If active group call exist, release group callb. Group call release requestc. Notify Userd. Group call release responseCSCFMCPTT Server
4b. 200 OK (SIP Notify)
4b. 200 OK (SIP Notify)
1. Group deletion request (HTTP DELETE)
2. Delete the group related information
3. Notify group deletion (SIP)
5. Group deletion response (HTTP 200 OK)
GMS
지령서버
MCPTT UE1
(group member)
4a. Notify group deletion (SIP)
a. If active group call exist, release group call
b. Group call release request
c. Notify User
d. Group call release response
CSCF
MCPTT Server
1. Group deletion request (HTTP DELETE)
2. Delete the group related information
3. Notify group deletion (SIP)
5. Group deletion response (HTTP 200 OK)
GMS
지령서버
MCPTT UE1
(group member)
4a. Notify group deletion (SIP)
a. If active group call exist, release group call
b. Group call release request
c. Notify User
d. Group call release response
CSCF
MCPTT Server
그림 12. 통화그룹 삭제
GMS는 지령서버로부터 그룹 삭제를 요청 받는다.
유효한 그룹인지를 검사하며, 그룹을 삭제한다.
삭제가 정상적으로 수행된 경우, MCPTT Server로 그룹 삭제에 대한 Notify를 보낸다.
삭제가 정상적으로 수행된 경우, MCPTT UE 로 그룹 삭제에 대한 Notify를 보내고, 단말은 200 OK 를 보낸다. 
지령서버로 그룹 삭제에 대한 결과를 보낸다.
3.2.1.5 통화그룹 멤버 추가 알림
- 가입자는 Registration 시, Group document 변경에 대한 Subscription 을 수행한 상태로 가정한다.
1. Group update request – add UE2 (HTTP PUT)GMS지령서버CSCF/MCPTTMCPTT ServerMCPTT UE1MCPTT UE22. Notify Group update (SIP)3. Group update confirmation response (HTTP 200 OK)INVITE200 OK180 RingingACK100 TryingDispatcher와 UE1이 멤버인 Pre-Arranged Group이 이미 생성되어 있다.4. Group retrieval request (HTTP XCAP GET)5. Group retrieval response (HTTP 200 OK)1. Group update request – add UE2 (HTTP PUT)GMS지령서버CSCF/MCPTTMCPTT ServerMCPTT UE1MCPTT UE22. Notify Group update (SIP)3. Group update confirmation response (HTTP 200 OK)INVITE200 OK180 RingingACK100 TryingDispatcher와 UE1이 멤버인 Pre-Arranged Group이 이미 생성되어 있다.4. Group retrieval request (HTTP XCAP GET)5. Group retrieval response (HTTP 200 OK)
1. Group update request – add UE2 (HTTP PUT)
GMS
지령서버
CSCF/MCPTT
MCPTT Server
MCPTT UE1
MCPTT UE2
2. Notify Group update (SIP)
3. Group update confirmation response (HTTP 200 OK)
INVITE
200 OK
180 Ringing
ACK
100 Trying
Dispatcher와 UE1이 멤버인 Pre-Arranged Group이 이미 생성되어 있다.
4. Group retrieval request (HTTP XCAP GET)
5. Group retrieval response (HTTP 200 OK)
1. Group update request – add UE2 (HTTP PUT)
GMS
지령서버
CSCF/MCPTT
MCPTT Server
MCPTT UE1
MCPTT UE2
2. Notify Group update (SIP)
3. Group update confirmation response (HTTP 200 OK)
INVITE
200 OK
180 Ringing
ACK
100 Trying
Dispatcher와 UE1이 멤버인 Pre-Arranged Group이 이미 생성되어 있다.
4. Group retrieval request (HTTP XCAP GET)
5. Group retrieval response (HTTP 200 OK)
그림 13. 통화그룹 멤버 추가
GMS는 지령서버로부터 통화그룹의 멤버 추가 요청을 받는다.
NOTIFY 메시지로 그룹 멤버들에게 Group 정보가 변경되었음을 알려준다.
CSC는 지령서버로 멤버가 추가되었음을 응답한다.
단말들은 CSC에 변경된 그룹정보를 요청한다.
CSC는 단말에 변경된 그룹정보를 전달한다.
MCPTT Server는 추가된 멤버에 자동으로 INVITE를 전송하여 통화에 초대한다.
3.2.1.6 통화그룹 멤버 삭제 알림
- 가입자는 Registration 시, Group document 변경에 대한 Subscription 을 수행한 상태로 가정한다.
1. Group update request – delete UE2 (HTTP PUT)GMSDispatcherCSCF/MCPTTMCPTT ServerMCPTT UE1MCPTT UE22. Notify Group update (SIP)3. Group update confirmation response (HTTP 200 OK)BYE200 OKDispatcher, UE1, UE2가 멤버인 Pre-Arranged Group이 이미 생성되어 있다.4. Group retrieval request (HTTP XCAP GET)5. Group retrieval response (HTTP 200 OK)1. Group update request – delete UE2 (HTTP PUT)GMSDispatcherCSCF/MCPTTMCPTT ServerMCPTT UE1MCPTT UE22. Notify Group update (SIP)3. Group update confirmation response (HTTP 200 OK)BYE200 OKDispatcher, UE1, UE2가 멤버인 Pre-Arranged Group이 이미 생성되어 있다.4. Group retrieval request (HTTP XCAP GET)5. Group retrieval response (HTTP 200 OK)
1. Group update request – delete UE2 (HTTP PUT)
GMS
Dispatcher
CSCF/MCPTT
MCPTT Server
MCPTT UE1
MCPTT UE2
2. Notify Group update (SIP)
3. Group update confirmation response (HTTP 200 OK)
BYE
200 OK
Dispatcher, UE1, UE2가 멤버인 Pre-Arranged Group이 이미 생성되어 있다.
4. Group retrieval request (HTTP XCAP GET)
5. Group retrieval response (HTTP 200 OK)
1. Group update request – delete UE2 (HTTP PUT)
GMS
Dispatcher
CSCF/MCPTT
MCPTT Server
MCPTT UE1
MCPTT UE2
2. Notify Group update (SIP)
3. Group update confirmation response (HTTP 200 OK)
BYE
200 OK
Dispatcher, UE1, UE2가 멤버인 Pre-Arranged Group이 이미 생성되어 있다.
4. Group retrieval request (HTTP XCAP GET)
5. Group retrieval response (HTTP 200 OK)
그림 14. 통화그룹 멤버 삭제
GMS는 지령서버로부터 통화그룹의 멤버 삭제 요청을 받는다.
NOTIFY 메시지로 그룹 멤버들에게 Group 정보가 변경되었음을 알려준다.
CSC는 지령서버로 멤버가 삭제되었음을 응답한다.
단말들은 CSC에 변경된 그룹정보를 요청한다.
CSC는 단말에 변경된 그룹정보를 전달한다.
MCPTT Server는 삭제된 멤버에 자동으로 BYE를 전송하여 통화를 종료시킨다.
3.2.2 GMS-UE 메시지 프로토콜
GMS와 UE 사이의 통신 메시지 프로토콜을 정의한다.
표 9. GMS-UE 메시지
Message
방향
Protocol
Group retrieval request
UE → GMS
HTTPS XCAP
Group retrieval response
GMS → UE
HTTPS XCAP
Subscribe GMS
UE → GMS
SIP Subscribe
Notify group creation
GMS → UE
SIP Notify
Notify group update
GMS → UE
SIP Notify
Notify group deletion
GMS → UE
SIP Notify
3.2.3 GMS-UE 메시지 포맷
3.2.3.1 Group XML Document Sample
- Group XML Document Sample의 value는 예제로 작성된 것임.
[Note] 원강선 사용 필드는 ‘CSC_Data_Configuration’ 엑셀 파일 참조
3.2.3.2 Group retrieval request
GET /org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133 HTTP/1.1Host: csc.mcptt.comaccess_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRwX-3GPP-Asserted-Identity: tel:+82510200011GET /org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133 HTTP/1.1Host: csc.mcptt.comaccess_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRwX-3GPP-Asserted-Identity: tel:+82510200011
GET /org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133 HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Asserted-Identity: tel:+82510200011
GET /org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133 HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Asserted-Identity: tel:+82510200011
3.2.3.3 Group retrieval response
HTTP/1.1 200 OK Etag: “033ff287c5b548cb8a79655edf226de3"Content-Type: application/vnd.oma.poc.groups+xml; charset="utf-8" <?xml version="1.0" encoding="UTF-8"?><group  xmlns="urn:oma:xml:poc:list-service"  xmlns:rl="urn:ietf:params:xml:ns:resource-lists"  xmlns:cp="urn:ietf:params:xml:ns:common-policy"  xmlns:ocp="urn:oma:xml:xdm:common-policy"  xmlns:oxe="urn:oma:xml:xdm:extensions"xmlns:mcpttgi="urn:3gpp:ns:mcpttGroupInfo:1.0">  <list-service uri="tel:+8293315310133">    <display-name xml:lang="en-us">My Group display name</display-name>    <list>      <entry uri="tel:+82510200011">        <rl:display-name>User 1001</rl:display-name>        <mcpttgi:on-network-required/>        <mcpttgi:user-priority>1</mcpttgi:user-priority>      </entry>      <entry uri="tel:+82510200012">        <rl:display-name>User 1002</rl:display-name>        <mcpttgi:on-network-required/>        <mcpttgi:user-priority>2</mcpttgi:user-priority>      </entry>      <entry uri="tel:+82510200013">        <rl:display-name>User 1003</rl:display-name>        <mcpttgi:user-priority>3</mcpttgi:user-priority>      </entry>    </list><mcpttgi:on-network-invite-members>true</mcpttgi:on-network-invite-members>    <mcpttgi:on-network-max-participant-count>10</mcpttgi:on-network-max-participant-count>    <cp:ruleset>      <cp:rule id="a7c">         <cp:actions>          <mcpttgi:allow-MCPTT-emergency-call>true</mcpttgi:allow-MCPTT-emergency-call>          <mcpttgi:allow-imminent-peril-call>true</mcpttgi:allow-imminent-peril-call>          <mcpttgi:allow-MCPTT-emergency-alert>true</mcpttgi:allow-MCPTT-emergency-alert>        </cp:actions>      </cp:rule>    </cp:ruleset>    <oxe:supported-services>     <oxe:service enabler="example.mcptt”>      <oxe:group-media>       <mcpttgi:mcptt-speech/>      </oxe:group-media>     </oxe:service>    </oxe:supported-services>    <mcpttgi:on-network-group-priority>5</mcpttgi:on-network-group-priority>  </list-service></group>HTTP/1.1 200 OK Etag: “033ff287c5b548cb8a79655edf226de3"Content-Type: application/vnd.oma.poc.groups+xml; charset="utf-8" <?xml version="1.0" encoding="UTF-8"?><group  xmlns="urn:oma:xml:poc:list-service"  xmlns:rl="urn:ietf:params:xml:ns:resource-lists"  xmlns:cp="urn:ietf:params:xml:ns:common-policy"  xmlns:ocp="urn:oma:xml:xdm:common-policy"  xmlns:oxe="urn:oma:xml:xdm:extensions"xmlns:mcpttgi="urn:3gpp:ns:mcpttGroupInfo:1.0">  <list-service uri="tel:+8293315310133">    <display-name xml:lang="en-us">My Group display name</display-name>    <list>      <entry uri="tel:+82510200011">        <rl:display-name>User 1001</rl:display-name>        <mcpttgi:on-network-required/>        <mcpttgi:user-priority>1</mcpttgi:user-priority>      </entry>      <entry uri="tel:+82510200012">        <rl:display-name>User 1002</rl:display-name>        <mcpttgi:on-network-required/>        <mcpttgi:user-priority>2</mcpttgi:user-priority>      </entry>      <entry uri="tel:+82510200013">        <rl:display-name>User 1003</rl:display-name>        <mcpttgi:user-priority>3</mcpttgi:user-priority>      </entry>    </list><mcpttgi:on-network-invite-members>true</mcpttgi:on-network-invite-members>    <mcpttgi:on-network-max-participant-count>10</mcpttgi:on-network-max-participant-count>    <cp:ruleset>      <cp:rule id="a7c">         <cp:actions>          <mcpttgi:allow-MCPTT-emergency-call>true</mcpttgi:allow-MCPTT-emergency-call>          <mcpttgi:allow-imminent-peril-call>true</mcpttgi:allow-imminent-peril-call>          <mcpttgi:allow-MCPTT-emergency-alert>true</mcpttgi:allow-MCPTT-emergency-alert>        </cp:actions>      </cp:rule>    </cp:ruleset>    <oxe:supported-services>     <oxe:service enabler="example.mcptt”>      <oxe:group-media>       <mcpttgi:mcptt-speech/>      </oxe:group-media>     </oxe:service>    </oxe:supported-services>    <mcpttgi:on-network-group-priority>5</mcpttgi:on-network-group-priority>  </list-service></group>
HTTP/1.1 200 OK 
Etag: “033ff287c5b548cb8a79655edf226de3"
Content-Type: application/vnd.oma.poc.groups+xml; charset="utf-8" 
<?xml version="1.0" encoding="UTF-8"?>
<group  xmlns="urn:oma:xml:poc:list-service"
  xmlns:rl="urn:ietf:params:xml:ns:resource-lists"
  xmlns:cp="urn:ietf:params:xml:ns:common-policy"
  xmlns:ocp="urn:oma:xml:xdm:common-policy"
  xmlns:oxe="urn:oma:xml:xdm:extensions"
xmlns:mcpttgi="urn:3gpp:ns:mcpttGroupInfo:1.0">
  <list-service uri="tel:+8293315310133">
    <display-name xml:lang="en-us">My Group display name</display-name>
    <list>
      <entry uri="tel:+82510200011">
        <rl:display-name>User 1001</rl:display-name>
        <mcpttgi:on-network-required/>
        <mcpttgi:user-priority>1</mcpttgi:user-priority>
      </entry>
      <entry uri="tel:+82510200012">
        <rl:display-name>User 1002</rl:display-name>
        <mcpttgi:on-network-required/>
        <mcpttgi:user-priority>2</mcpttgi:user-priority>
      </entry>
      <entry uri="tel:+82510200013">
        <rl:display-name>User 1003</rl:display-name>
        <mcpttgi:user-priority>3</mcpttgi:user-priority>
      </entry>
    </list>
<mcpttgi:on-network-invite-members>true</mcpttgi:on-network-invite-members>
    <mcpttgi:on-network-max-participant-count>10</mcpttgi:on-network-max-participant-count>
    <cp:ruleset>
      <cp:rule id="a7c">
         <cp:actions>
          <mcpttgi:allow-MCPTT-emergency-call>true</mcpttgi:allow-MCPTT-emergency-call>
          <mcpttgi:allow-imminent-peril-call>true</mcpttgi:allow-imminent-peril-call>
          <mcpttgi:allow-MCPTT-emergency-alert>true</mcpttgi:allow-MCPTT-emergency-alert>
        </cp:actions>
      </cp:rule>
    </cp:ruleset>
    <oxe:supported-services>
     <oxe:service enabler="example.mcptt”>
      <oxe:group-media>
       <mcpttgi:mcptt-speech/>
      </oxe:group-media>
     </oxe:service>
    </oxe:supported-services>
    <mcpttgi:on-network-group-priority>5</mcpttgi:on-network-group-priority>
  </list-service>
</group>
HTTP/1.1 200 OK 
Etag: “033ff287c5b548cb8a79655edf226de3"
Content-Type: application/vnd.oma.poc.groups+xml; charset="utf-8" 
<?xml version="1.0" encoding="UTF-8"?>
<group  xmlns="urn:oma:xml:poc:list-service"
  xmlns:rl="urn:ietf:params:xml:ns:resource-lists"
  xmlns:cp="urn:ietf:params:xml:ns:common-policy"
  xmlns:ocp="urn:oma:xml:xdm:common-policy"
  xmlns:oxe="urn:oma:xml:xdm:extensions"
xmlns:mcpttgi="urn:3gpp:ns:mcpttGroupInfo:1.0">
  <list-service uri="tel:+8293315310133">
    <display-name xml:lang="en-us">My Group display name</display-name>
    <list>
      <entry uri="tel:+82510200011">
        <rl:display-name>User 1001</rl:display-name>
        <mcpttgi:on-network-required/>
        <mcpttgi:user-priority>1</mcpttgi:user-priority>
      </entry>
      <entry uri="tel:+82510200012">
        <rl:display-name>User 1002</rl:display-name>
        <mcpttgi:on-network-required/>
        <mcpttgi:user-priority>2</mcpttgi:user-priority>
      </entry>
      <entry uri="tel:+82510200013">
        <rl:display-name>User 1003</rl:display-name>
        <mcpttgi:user-priority>3</mcpttgi:user-priority>
      </entry>
    </list>
<mcpttgi:on-network-invite-members>true</mcpttgi:on-network-invite-members>
    <mcpttgi:on-network-max-participant-count>10</mcpttgi:on-network-max-participant-count>
    <cp:ruleset>
      <cp:rule id="a7c">
         <cp:actions>
          <mcpttgi:allow-MCPTT-emergency-call>true</mcpttgi:allow-MCPTT-emergency-call>
          <mcpttgi:allow-imminent-peril-call>true</mcpttgi:allow-imminent-peril-call>
          <mcpttgi:allow-MCPTT-emergency-alert>true</mcpttgi:allow-MCPTT-emergency-alert>
        </cp:actions>
      </cp:rule>
    </cp:ruleset>
    <oxe:supported-services>
     <oxe:service enabler="example.mcptt”>
      <oxe:group-media>
       <mcpttgi:mcptt-speech/>
      </oxe:group-media>
     </oxe:service>
    </oxe:supported-services>
    <mcpttgi:on-network-group-priority>5</mcpttgi:on-network-group-priority>
  </list-service>
</group>
3.2.3.4 Subscribe GMS (UE -> CSCF -> CSC)
SUBSCRIBE sip:gms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 From: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b To: <tel:+825024470200> Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b CSeq: 1 SUBSCRIBE P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed4-786d2b-39e9046b-cb507f0 Expires: 3600 Event: xcap-diff Max-Forwards: 70 Supported: timer Accept: application/xcap-diff+xml Contact: <sip:+825024470200@30.1.1.2:5060> Content-Type: application/resource-lists+xml;charset="utf-8" Content-Length: 218 <?xml version="1.0" encoding="UTF-8"?> <resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> <list> <entry uri="org.openmobilealliance.groups/users/tel:+825024470200"/> </list> </resource-lists>SUBSCRIBE sip:gms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 From: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b To: <tel:+825024470200> Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b CSeq: 1 SUBSCRIBE P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed4-786d2b-39e9046b-cb507f0 Expires: 3600 Event: xcap-diff Max-Forwards: 70 Supported: timer Accept: application/xcap-diff+xml Contact: <sip:+825024470200@30.1.1.2:5060> Content-Type: application/resource-lists+xml;charset="utf-8" Content-Length: 218 <?xml version="1.0" encoding="UTF-8"?> <resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> <list> <entry uri="org.openmobilealliance.groups/users/tel:+825024470200"/> </list> </resource-lists>
SUBSCRIBE sip:gms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 
From: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
To: <tel:+825024470200> 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
CSeq: 1 SUBSCRIBE 
P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f 
Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed4-786d2b-39e9046b-cb507f0 
Expires: 3600 
Event: xcap-diff 
Max-Forwards: 70 
Supported: timer 
Accept: application/xcap-diff+xml 
Contact: <sip:+825024470200@30.1.1.2:5060> 
Content-Type: application/resource-lists+xml;charset="utf-8" 
Content-Length: 218 
<?xml version="1.0" encoding="UTF-8"?> 
<resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> 
<list> 
<entry uri="org.openmobilealliance.groups/users/tel:+825024470200"/> 
</list> </resource-lists>
SUBSCRIBE sip:gms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 
From: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
To: <tel:+825024470200> 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
CSeq: 1 SUBSCRIBE 
P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f 
Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed4-786d2b-39e9046b-cb507f0 
Expires: 3600 
Event: xcap-diff 
Max-Forwards: 70 
Supported: timer 
Accept: application/xcap-diff+xml 
Contact: <sip:+825024470200@30.1.1.2:5060> 
Content-Type: application/resource-lists+xml;charset="utf-8" 
Content-Length: 218 
<?xml version="1.0" encoding="UTF-8"?> 
<resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> 
<list> 
<entry uri="org.openmobilealliance.groups/users/tel:+825024470200"/> 
</list> </resource-lists>
3.2.3.5 Notify group creation (CSC -> CSCF -> UE)
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... CSeq: 2 NOTIFY From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e Event: xcap-diff Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> Supported: eventlist Content-Type: application/xcap-diff+xml;charset="utf-8" Max-Forwards: 68 Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> Content-Length: 606 Subscription-State: active;expires=3383 Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) <?xml version="1.0" encoding="UTF-8"?><xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/"><document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/></xcap-diff>NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... CSeq: 2 NOTIFY From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e Event: xcap-diff Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> Supported: eventlist Content-Type: application/xcap-diff+xml;charset="utf-8" Max-Forwards: 68 Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> Content-Length: 606 Subscription-State: active;expires=3383 Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) <?xml version="1.0" encoding="UTF-8"?><xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/"><document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/></xcap-diff>
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 
To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... 
CSeq: 2 NOTIFY 
From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e 
Event: xcap-diff 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> 
Supported: eventlist 
Content-Type: application/xcap-diff+xml;charset="utf-8" 
Max-Forwards: 68 
Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> 
Content-Length: 606 
Subscription-State: active;expires=3383 
Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) 
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/">
<document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/>
</xcap-diff>
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 
To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... 
CSeq: 2 NOTIFY 
From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e 
Event: xcap-diff 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> 
Supported: eventlist 
Content-Type: application/xcap-diff+xml;charset="utf-8" 
Max-Forwards: 68 
Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> 
Content-Length: 606 
Subscription-State: active;expires=3383 
Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) 
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/">
<document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/>
</xcap-diff>
3.2.3.6 Notify group update (CSC -> CSCF -> UE)
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... CSeq: 2 NOTIFY From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e Event: xcap-diff Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> Supported: eventlist Content-Type: application/xcap-diff+xml;charset="utf-8" Max-Forwards: 68 Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> Content-Length: 606 Subscription-State: active;expires=3383 Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) <?xml version="1.0" encoding="UTF-8"?><xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/"><document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/></xcap-diff>NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... CSeq: 2 NOTIFY From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e Event: xcap-diff Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> Supported: eventlist Content-Type: application/xcap-diff+xml;charset="utf-8" Max-Forwards: 68 Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> Content-Length: 606 Subscription-State: active;expires=3383 Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) <?xml version="1.0" encoding="UTF-8"?><xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/"><document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/></xcap-diff>
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 
To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... 
CSeq: 2 NOTIFY 
From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e 
Event: xcap-diff 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> 
Supported: eventlist 
Content-Type: application/xcap-diff+xml;charset="utf-8" 
Max-Forwards: 68 
Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> 
Content-Length: 606 
Subscription-State: active;expires=3383 
Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) 
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/">
<document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/>
</xcap-diff>
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 
To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... 
CSeq: 2 NOTIFY 
From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e 
Event: xcap-diff 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> 
Supported: eventlist 
Content-Type: application/xcap-diff+xml;charset="utf-8" 
Max-Forwards: 68 
Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> 
Content-Length: 606 
Subscription-State: active;expires=3383 
Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) 
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/">
<document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/>
</xcap-diff>
3.2.3.7 Notify group deletion (CSC -> CSCF -> UE)
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... CSeq: 2 NOTIFY From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e Event: xcap-diff Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> Supported: eventlist Content-Type: application/xcap-diff+xml;charset="utf-8" Max-Forwards: 68 Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> Content-Length: 606 Subscription-State: active;expires=3383 Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) <?xml version="1.0" encoding="UTF-8"?><xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/"><document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/></xcap-diff>NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... CSeq: 2 NOTIFY From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e Event: xcap-diff Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> Supported: eventlist Content-Type: application/xcap-diff+xml;charset="utf-8" Max-Forwards: 68 Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> Content-Length: 606 Subscription-State: active;expires=3383 Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) <?xml version="1.0" encoding="UTF-8"?><xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/"><document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/></xcap-diff>
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 
To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... 
CSeq: 2 NOTIFY 
From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e 
Event: xcap-diff 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> 
Supported: eventlist 
Content-Type: application/xcap-diff+xml;charset="utf-8" 
Max-Forwards: 68 
Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> 
Content-Length: 606 
Subscription-State: active;expires=3383 
Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) 
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/">
<document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/>
</xcap-diff>
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0 
To: <tel:+825024470200>;tag=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b 
Via: SIP/2.0/UDP 10.121.4.2:5080;branch=z9hG4bK1f7e0782_1.1.2.20994.24880.0.... 
CSeq: 2 NOTIFY 
From: <tel:+825024470200>;tag=7fc9ade7ff28-0-13c4-55022-15301e-3ed51f78-15301e 
Event: xcap-diff 
Call-ID: d4d6468-201011e-13c4-65014-786d2b-5227924f-786d2b 
Contact: <sip:subscription_proxy@10.121.2.90:5060;transport=udp> 
Supported: eventlist 
Content-Type: application/xcap-diff+xml;charset="utf-8" 
Max-Forwards: 68 
Record-Route: <sip:1.1.2.......@10.121.4.2:5080;lr;subs;ft=d43dd20-201011e-13c4-65014-786d2b-5845b5dd-786d2b;pv=45031825024470200%40ptt.mnc031.mcc450.3gppnetwork.org;at=1> 
Content-Length: 606 
Subscription-State: active;expires=3383 
Server: MCPTT-CSC100A-V1.0.1 SIPAs(Feb 3 2017 13:45:27) 
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://10.121.2.90:4420/">
<document new-etag="9npEsM74pdY" sel="org.openmobilealliance.groups/users/tel:+825024470200/tel:+8299000010550"/>
</xcap-diff>
3.3 CMS-UE 인터페이스 (CSC-4)
3.3.1 CMS-UE Signal Flow
* CMC: 단말임
3.3.1.1 User Profile 검색
그림 15. User Profile 검색 Signal Flow
3.3.1.2 User Profile 업데이트 알림
그림 16. User Profile 업데이트 알림 Signal Flow
3.3.1.3 Service Configuration 검색
그림 17. Service Configuration 검색 Signal Flow 
3.3.2 CMS-UE 메시지 프로토콜
CMS와 UE 간의 통신 메시지 프로토콜을 정의한다.
표 10. CMS-UE 메시지
Message
방향
Protocol
Subscribe CMS
UE → CMS
SIP Subscribe
User profile retrieval request
UE → CMS
HTTPS XCAP
User profile retrieval response
CMS → UE
HTTPS XCAP
Notify user profile update
CMS → UE
SIP Notify
Notify UE Configuration  update
CMS → UE
SIP Notify
Service Configuration retrieval request
UE → CMS
HTTPS XCAP
Service Configuration retrieval response
CMS → UE
HTTPS XCAP
Notify Service Configuration  update
CMS → UE
SIP Notify
3.3.3 CMS-UE 메시지 포맷
3.3.3.1 Subscribe CMS
단말은 user-profile 과 service-config 정보에 대하여 CMS 로 xcap-diff event subscription 을 수행한다.
SUBSCRIBE sip:cms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 From: <tel:+825024470200>;tag=d43d9a0-201011e-13c4-65014-786c1e-2213da29-786c1e To: <tel:+825024470200> Call-ID: d4d6238-201011e-13c4-65014-786c1e-342f2d3-786c1e CSeq: 1 SUBSCRIBE P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed3-786c1e-7568c7fe-cb504c0 Expires: 3600 Event: xcap-diff Max-Forwards: 70 Supported: timer Accept: application/xcap-diff+xml Contact: <sip:+825024470200@30.1.1.2:5060> Content-Type: application/resource-lists+xml;charset="utf-8" Content-Length: 486 <?xml version="1.0" encoding="UTF-8"?> <resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> <list> <entry uri="org.3gpp.mcptt.user-profile/users/tel:+825024470200/user-profile"/> <entry uri="org.3gpp.mcptt.service-config/users/tel:+825024470200/service-config"/> </list> </resource-lists> SUBSCRIBE sip:cms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 From: <tel:+825024470200>;tag=d43d9a0-201011e-13c4-65014-786c1e-2213da29-786c1e To: <tel:+825024470200> Call-ID: d4d6238-201011e-13c4-65014-786c1e-342f2d3-786c1e CSeq: 1 SUBSCRIBE P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed3-786c1e-7568c7fe-cb504c0 Expires: 3600 Event: xcap-diff Max-Forwards: 70 Supported: timer Accept: application/xcap-diff+xml Contact: <sip:+825024470200@30.1.1.2:5060> Content-Type: application/resource-lists+xml;charset="utf-8" Content-Length: 486 <?xml version="1.0" encoding="UTF-8"?> <resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> <list> <entry uri="org.3gpp.mcptt.user-profile/users/tel:+825024470200/user-profile"/> <entry uri="org.3gpp.mcptt.service-config/users/tel:+825024470200/service-config"/> </list> </resource-lists> 
SUBSCRIBE sip:cms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 
From: <tel:+825024470200>;tag=d43d9a0-201011e-13c4-65014-786c1e-2213da29-786c1e 
To: <tel:+825024470200> 
Call-ID: d4d6238-201011e-13c4-65014-786c1e-342f2d3-786c1e 
CSeq: 1 SUBSCRIBE 
P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f 
Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed3-786c1e-7568c7fe-cb504c0 
Expires: 3600 
Event: xcap-diff 
Max-Forwards: 70 
Supported: timer 
Accept: application/xcap-diff+xml 
Contact: <sip:+825024470200@30.1.1.2:5060> 
Content-Type: application/resource-lists+xml;charset="utf-8" 
Content-Length: 486 
<?xml version="1.0" encoding="UTF-8"?> 
<resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> 
<list> 
<entry uri="org.3gpp.mcptt.user-profile/users/tel:+825024470200/user-profile"/> 
<entry uri="org.3gpp.mcptt.service-config/users/tel:+825024470200/service-config"/> 
</list> 
</resource-lists> 
SUBSCRIBE sip:cms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0 
From: <tel:+825024470200>;tag=d43d9a0-201011e-13c4-65014-786c1e-2213da29-786c1e 
To: <tel:+825024470200> 
Call-ID: d4d6238-201011e-13c4-65014-786c1e-342f2d3-786c1e 
CSeq: 1 SUBSCRIBE 
P-Access-Network-Info: 3GPP-E-UTRAN;utran-cell-id-3gpp=450053703204da0f 
Via: SIP/2.0/UDP 30.1.1.2:5060;rport;branch=z9hG4bK-1ed3-786c1e-7568c7fe-cb504c0 
Expires: 3600 
Event: xcap-diff 
Max-Forwards: 70 
Supported: timer 
Accept: application/xcap-diff+xml 
Contact: <sip:+825024470200@30.1.1.2:5060> 
Content-Type: application/resource-lists+xml;charset="utf-8" 
Content-Length: 486 
<?xml version="1.0" encoding="UTF-8"?> 
<resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists"> 
<list> 
<entry uri="org.3gpp.mcptt.user-profile/users/tel:+825024470200/user-profile"/> 
<entry uri="org.3gpp.mcptt.service-config/users/tel:+825024470200/service-config"/> 
</list> 
</resource-lists> 
3.3.3.2 User profile XML Document Sample
- User profile XML Document Sample의 value는 예제로 작성된 것이며 추후 변경 예정임.
- User profile XML의 <Name>은 CMS Client가 할당 받은 MCPTT User ID를 사용 해야 한다.
[Note] 원강선 사용 필드는 ‘CSC_Data_Configuration’ 엑셀 파일 참조
3.3.3.3 User profile retrieval request
GET /org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Asserted-Identity: tel:+82510200011
3.3.3.4 User profile retrieval response
HTTP/1.1 200 OK
Etag: “033ff287c5b548cb8a79655edf226de3"
Content-Type: application/vnd.3gpp.mcptt-user-profile+xml; charset="utf-8“
< !-- Body는 3.3.3.2 User profile XML Document Sample 과 동일 -->
HTTP/1.1 404 Not Found
HTTP/1.1 405 Method not allowed
3.3.3.5 Notify user profile update
NOTIFY sip:+825024470200@30.1.1.2:5060 SIP/2.0
Subscription-State: active;expires=3600
Event: xcap-diff
Content-Type: application/xcap-diff+xml;charset="utf-8"
Content-Length: (…)
…
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://csc.mcptt.com/">
  <document previous-etag="033ff287c5b548cb8a79655edf226de3" sel="org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile" new-etag="3qb2XNa8CSzDVUSVTmSi1jkJFfTlk7bl"/>
</xcap-diff>
3.3.3.6 Service Configuration XML Document Sample
- Service Configuration  XML Document Sample의 value는 예시로 작성한 것이며 추후 변경 예정임.
- Service Configuration XML의 <common><alias><id>는 CMS Client가 할당 받은 MCPTT User ID를 사용 해야 한다.
[Note] 원강선 사용 필드는 ‘CSC_Data_Configuration’ 엑셀 파일 참조
3.3.3.7 Service Configuration retrieval request
GET /org.3gpp.mcptt.service-config/users/tel:+82510200011/service-config  HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Asserted-Identity: tel:+82510200011
3.3.3.8 Service Configuration retrieval response
HTTP/1.1 200 OK 
Etag: “Iwo7J4ogHFZQxwQ2RQ0DRJKRETPVzxlF”
Content-Type: application/vnd.3gpp.mcptt-service-config+xml; charset="utf-8"
< !-- Body는 3.3.3.18 Service Configuration XML Document Sample 과 동일 -->
HTTP/1.1 404 Not Found
HTTP/1.1 405 Method not allowed
3.3.3.9 Notify Service Configuration update
NOTIFY sip:+825024470200@30.1.1.2:5060  SIP/2.0
Subscription-State: active;expires=3000
Event: xcap-diff
Content-Type: application/xcap-diff+xml;charset="utf-8"
Content-Length: (…)
…
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://csc.mcptt.com/">
  <document previous-etag="7yY6UlvTQHOLRU9fQZXZNdhYLmj6RqBW" sel=" org.3gpp.mcptt.service-config/users/tel:+82510200011/service-config" new-etag="wdohUtc3vEbkYyg9KiBS8fjP3P1EYJiU"/>
</xcap-diff>
3.4 KMS-UE 인터페이스 (CSC-8)
3.4.1 KMS-UE Signal Flow
그림 18. KMS-UE 간 Signal Flow
KMS Certificate는 사용자의 전체 도메인에 적용되는 증명서이다.
KMS는 KMS에 의해 사용되는 공개 키를 포함하는 명확하게 하나의 루트 인증서를 가진다.
루트 인증서는 KMS가 개인 키를 가지고 있는 유일한 증명서이고, 사용자에 관련된 key material을 생성 할 수 있다.
루트 인증서가 갱신될 필요가 있다면 새로운 KMS URI를 가진 새로운 KMS는 새로운 루트 인증서로 설치되어야 한다.
MCPTT 사용자는 한 개의 KMS에 의해 관리된다.
이 KMS를 위한 루트 인증서는 MCPTT 사용자에게 메시지를 암호화하고, MCPTT 사용자로부터 서명을 검증하도록 요구된다.
3.4.2 KMS-UE 메시지 프로토콜
KMS와 UE 간의 통신 메시지 프로토콜을 정의한다.
표 11. KMS-UE 메시지
Message
방향
Protocol
KMS certificate request
UE → KMS
HTTPS
KMS certificate response
KMS → UE
HTTPS
User key provision request
UE → KMS
HTTPS
User key provision response
KMS → UE
HTTPS
3.4.3 KMS-UE 메시지 포맷
3.4.3.1 KMS certificate request
Request
POST /keymanagement/identity/v1/init HTTP/1.1 
Host: 10.121.2.90:4430 
Connection: keep-alive 
Accept-Encoding: gzip, deflate 
Accept: */* 
User-Agent: python-requests/2.12.1 
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1NzEwMDk5OTAiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTE0NTM1MTEsInNjb3BlIjpbIm9wZW5pZCUyMDNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.PWtveTCfs8hA27tc09P3lV42rp-52Hi34DZNPOUVbEK_1kvOcRM4kdn82C-_ingWkcLrl_Xm0fDMajyyX-OYsE44CJ_Xus8Q8WRk7vUvQw5A84MjjbARtCn2hTMB_7gxpGfADtDi-qf40ohcb1V7pERjeDfTEXhAy3Z2VhnpS4MBrMV0eklJ6JmrK9duaNc6q-qNZ1BtTcPnbbxSeQagkUf3fc6LzDGQHHmX86NEEy3wyfp9oTKBfYszNdPR-bSnVjloc90UooSkwRHcyKwieK9qo97VC8xB5uuKy3a3QQNb_taygQGDiqnqe9lglqYPwH3IadHy17mbqQwRAFB-yg 
X-3GPP-Asserted-Identity: tel:+82571009990 
Content-Type: application/x-www-form-urlencoded 
Cookie: session_id=sorryidontcare 
Content-Length: 64 
3.4.3.2 KMS certificate response
표 12. KMS certificate response Parameter
Name
Description
Version
(Attribute) The version number of the certificate type (1.1.0).
Role
(Attribute) This shall indicate whether the certificate is a "Root" or "External" certificate.
CertUri
(Optional) The URI of the Certificate (this object).
KmsUri
The URI of the KMS which issued the Certificate.
Issuer
(Optional) String describing the issuing entity.
ValidFrom
(Optional) Date from which the Certificate may be used.
ValidTo
(Optional) Date at which the Certificate expires.
Revoked
(Optional) A Boolean value defining whether a Certificate has been revoked.
UserIDFormat
Shall contain the value '2', indicating that the generation mechanism defined in TS 33.179 clause F.2.1 shall be used.
UserKeyPeriod
The number of seconds that each user key issued by this KMS should be used (e.g. '2419200').
UserKeyOffset
The offset in seconds from 0h on 1st Jan 1900 that the segmentation of key periods starts (e.g. '0').
PubEncKey
The SAKKE Public Key, "Z", as defined in [RFC6508]. This is an OCTET STRING encoding of an elliptic curve point.
PubAuthKey
The ECCSI Public Key, "KPAK" as defined in [RFC6507]. This is an OCTET STRING encoding of an elliptic curve point.
ParameterSet
(Optional) The choice of parameter set used for SAKKE and ECCSI (e.g. '1').
KmsDomainList
(Optional) List of domains associated with the certificate.
Response
HTTP/1.1 200 OK
Content-Type: application/xml
<?xml version="1.0" encoding="UTF-8"?>
<KmsResponse Version="1.1.0" xmlns="http://org.csc.kms" xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
<KmsUri>kms.mcptt.com</KmsUri>
<UserUri>tel:+82571009990@ps-lte.com</UserUri>
<Time>2017-04-06T11:38:57+09:00</Time>
<KmsId>kmsprovider12345</KmsId>
<ClientReqUrl>http://10.121.2.90/keymanagement/identity/v1/init</ClientReqUrl>
<KmsMessage>
<KmsInit Version="1.0.0">
<KmsCertificate Version="1.0.0" Role="Root">
<KmsUri>kms.mcptt.com</KmsUri>
<Issuer>www.mcptt.com</Issuer>
<ValidFrom>2016-11-01T00:00:00+09:00</ValidFrom>
<ValidTo>2036-10-31T23:59:59+09:00</ValidTo>
<UserIdFormat>2</UserIdFormat>
<UserKeyPeriod>2419200</UserKeyPeriod>
<UserKeyOffset>0</UserKeyOffset>
<PubEncKey>041C7B84B4FD620D49F3DC2366A7F62F48221D7B32D61D2A16685A015FDACF03CDDBAA66B78C597410C290EE3E8D7FE950193B87DABD3A33180DCEEF66893B24504EA22C9C7FD46BDCD385AF14EC71A57F94363692FA7FE0CE931BCF7A4F95A32723A459AC0ED72ECF17A8E9E2EBF94976E493134F5D11EE3D42165B5EF6E22FDD5269CBD01D339A5768521E36E1A1BEF2EC0D4B2606943DFAFB010A806F553E81350039EABD25FBF0758F25FC38E730553C19675B796DFE005C16696B3879388547282B3A3F56ADA1EA3C01AF77DE412EA62D4676D2386F745304B8B3AD63BB8E4E01C3C342B984B57512EA58A5049CE04BA2D00A36A3C78F46A364A670DE9F64</PubEncKey>
<PubAuthKey>0467EF33902289EA2F42A82912CFD12B517A321EED22D56EB9B5AA60A3A38F97B77A29B3875339F141E454E3A9CF53A3C0353B1A88868A39A15D74A7B235E09EB8</PubAuthKey>
<ParameterSet>1</ParameterSet>
</KmsCertificate>
</KmsInit>
</KmsMessage>
</KmsResponse>
3.4.3.3 User key provision request
Request
POST /keymanagement/identity/v1/keyprov HTTP/1.1 
Host: 10.121.2.90:4430 
Connection: keep-alive 
Accept-Encoding: gzip, deflate 
Accept: */* 
User-Agent: python-requests/2.12.1 
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1NzEwMDk5OTAiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTE0NTM1MTEsInNjb3BlIjpbIm9wZW5pZCUyMDNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.PWtveTCfs8hA27tc09P3lV42rp-52Hi34DZNPOUVbEK_1kvOcRM4kdn82C-_ingWkcLrl_Xm0fDMajyyX-OYsE44CJ_Xus8Q8WRk7vUvQw5A84MjjbARtCn2hTMB_7gxpGfADtDi-qf40ohcb1V7pERjeDfTEXhAy3Z2VhnpS4MBrMV0eklJ6JmrK9duaNc6q-qNZ1BtTcPnbbxSeQagkUf3fc6LzDGQHHmX86NEEy3wyfp9oTKBfYszNdPR-bSnVjloc90UooSkwRHcyKwieK9qo97VC8xB5uuKy3a3QQNb_taygQGDiqnqe9lglqYPwH3IadHy17mbqQwRAFB-yg 
X-3GPP-Asserted-Identity: tel:+82571009990 
Content-Type: application/x-www-form-urlencoded 
Cookie: session_id=sorryidontcare 
Content-Length: 64 
MCPTTID=tel:%2b82571009990&UserUri=tel:%2b82571009990@ps-lte.com
3.4.3.4 User key provision response
표 13. User key provision response Parameter
Name
Description
Version
(Attribute) The version number of the key provision XML (1.1.0).
KmsUri
The URI of the KMS which issued the key set.
CertUri
(Optional) The URI of the Certificate which may be used to validate the key set.
Issuer
(Optional) String describing the issuing entity.
UserUri
URI of the user for which the key set is issued.
UserID
UID corresponding to the key set.
ValidFrom
(Optional) Date and time from which the key set may be used.
ValidTo
(Optional) Date and time at which the key set expires.
KeyPeriodNo
Current Key Period No. since 1 January 1900 (e.g. 1514)
Revoked
(Optional) A Boolean value defining whether the key set has been revoked.
UserDecryptKey
The SAKKE "Receiver Secret Key" as defined in [RFC6508]. This is an OCTET STRING encoding of an elliptic curve point as defined in section 2.2 of [RFC6090].
UserSigningKeySSK
The ECCSI private Key, "SSK" as defined in [RFC6507]. This is an OCTET STRING encoding of an integer as described in section 6 of [RFC5480].
UserPubTokenPVT
The ECCSI public validation token, "PVT" as defined in [9]. This is an OCTET STRING encoding of an elliptic curve point as defined in Section 2.2 of [RFC6090].
Response
HTTP/1.1 200 OK 
Pragma: No-cache 
Cache-Control: no-cache 
Expires: -1 
Content-Type: application/xml 
Content-Length: 1746 
Date: Thu, 06 Apr 2017 02:56:45 GMT 
Server: CSCI 
<?xml version="1.0" encoding="UTF-8"?>
<KmsResponse Version="1.1.0" xmlns="http://org.csc.kms" xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
<KmsUri>kms.mcptt.com</KmsUri>
<UserUri>tel:+82571009990@ptt.mnc031.mcc450.3gppnetwork.org</UserUri>
<Time>2017-04-06T11:56:45+09:00</Time>
<KmsId>kmsprovider12345</KmsId>
<ClientReqUrl>http://10.121.2.90/keymanagement/identity/v1/init</ClientReqUrl>
<KmsMessage>
<KmsInit Version="1.0.0">
<KmsCertificate Version="1.0.0" Role="Root">
<KmsUri>kms.mcptt.com</KmsUri>
<Issuer>www.mcptt.com</Issuer>
<ValidFrom>2016-11-01T00:00:00+09:00</ValidFrom>
<ValidTo>2036-10-31T23:59:59+09:00</ValidTo>
<UserIdFormat>2</UserIdFormat>
<UserKeyPeriod>2419200</UserKeyPeriod>
<UserKeyOffset>0</UserKeyOffset>
<PubEncKey>041C7B84B4FD620D49F3DC2366A7F62F48221D7B32D61D2A16685A015FDACF03CDDBAA66B78C597410C290EE3E8D7FE950193B87DABD3A33180DCEEF66893B24504EA22C9C7FD46BDCD385AF14EC71A57F94363692FA7FE0CE931BCF7A4F95A32723A459AC0ED72ECF17A8E9E2EBF94976E493134F5D11EE3D42165B5EF6E22FDD5269CBD01D339A5768521E36E1A1BEF2EC0D4B2606943DFAFB010A806F553E81350039EABD25FBF0758F25FC38E730553C19675B796DFE005C16696B3879388547282B3A3F56ADA1EA3C01AF77DE412EA62D4676D2386F745304B8B3AD63BB8E4E01C3C342B984B57512EA58A5049CE04BA2D00A36A3C78F46A364A670DE9F64</PubEncKey>
<PubAuthKey>0467EF33902289EA2F42A82912CFD12B517A321EED22D56EB9B5AA60A3A38F97B77A29B3875339F141E454E3A9CF53A3C0353B1A88868A39A15D74A7B235E09EB8</PubAuthKey>
<ParameterSet>1</ParameterSet>
</KmsCertificate>
</KmsInit>
</KmsMessage>
</KmsResponse>
4. XCAP Examples
4.1 Document Directory
4.1.1 일반
- CSC에서 관리하고 있는 XUI에 해당하는 모든 문서의 리스트를 저장하는 문서
- 아래와 같은 AUID의 문서 리스트를 제공
org.3gpp.mcptt.ue-config
org.3gpp.mcptt.user-profile
org.3gpp.mcptt.service-config
org.openmobilealliance.groups
4.1.2 코딩
- XML Documents Directory의 문서 구조는 아래와 같다.
<xcap-directory> root element 
a) <folder> 1개 이상 element: AUID 및 User Directory에 해당하는 entry 정보
<folder> element
a) auid 속성: 해당 AUID 
b) <entry> 1개 이상 element: 해당 문서에 대한 정보
<entry> element
a) uri 속성: 해당 문서의 uri
b) etag 속성: 해당 문서의 etag
4.1.3 Document Directory 획득
Request
GET /org.openmobilealliance.xcap-directory/users/tel:+82510200011/directory.xml HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Intended-Identity: tel:+82510200011
Response
HTTP/1.1 200 OK
Content-Type: application/vnd.oma.xcap-directory+xml; charset=UTF-8
Content-Length: (...)
…
<?xml version="1.0" encoding="UTF-8"?>
<xcap-directory xmlns="urn:oma:xml:xdm:xcap-directory" >
  <folder auid="org.3gpp.mcptt.ue-config">
    <entry uri="http://csc.mcptt.com/org.3gpp.mcptt.ue-config/users/tel:+82510200011/ue-config" etag="abc123"/>
  </folder>
  <folder auid="org.3gpp.mcptt.user-profile">
    <entry uri="http://csc.mcptt.com/org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile" etag="def456 "/>
  </folder>
  <folder auid="org.openmobilealliance.groups" entry-count="3">
    <entry uri="http://csc.mcptt.com/org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133" etag=“jkl012"/>
    <entry uri="http://csc.mcptt.com/org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310134" etag=“mno345"/>
    <entry uri="http://csc.mcptt.com/org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310135" etag=“pqr678"/>
  </folder>
</xcap-directory>
4.2 User profile configuration document
4.2.1 일반
- CSC에서 관리하고 있는 MCPTT user profile을 저장하는 문서
4.2.2 코딩
- 7.8 User Profile schema 참조.
4.2.3 Document 획득
- 3.3.3.1항 3.3.3.2항 참조
4.2.4 Element 획득
GET /org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile/~~/user-profile/Common
/MCPTTUserID  HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Asserted-Identity: tel:+82510200011
HTTP/1.1 200 OK 
Etag: “0MLEGiGwN8wK8ThUNl8U70zuKXRw3AE3”
Content-Type: application/xcap-el+xml; charset="utf-8"
< MCPTTUserID index=“tel:+82510200011”>
    <uri-entry >http://csc.mcptt.com/org.3gpp.mcptt.user-profile /users/tel:+82510200011 
</uri-entry >
     <display-name xml:lang="en-us"> tel:+82510200011</display-name>
</MCPTTUserID > 
HTTP/1.1 404 Not Found
HTTP/1.1 405 Method not allowed
4.3 Service configuration document
4.3.1 일반
- CSC에서 관리하고 있는 MCPTT Service configuration을 저장하는 문서
4.3.2 코딩
- 6.9 Service configuration schema 참조
4.3.3 Document 획득
- 3.3.3.19항 3.3.3.20항 참조
4.3.4 Element 획득
GET /org.3gpp.mcptt.service-config/users/tel:+82510200011/service-config/~~/service-configuration
/common/broadcast-group HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Asserted-Identity: tel:+82510200011
HTTP/1.1 200 OK 
Etag: “VTGvRnMgDsXzkhmnQ8HIETX9ZsidQRLv”
Content-Type: application/xcap-el+xml; charset="utf-8"
<num-levels-group-hierarchy >3</num-levels-group-hierarchy >
<num-levels-user-hierarchy >3</num-levels-user-hierarchy >
HTTP/1.1 404 Not Found
HTTP/1.1 405 Method not allowed
4.4 Group configuration document
4.4.1 일반
- MCPTT 시스템에서 관리하는 Group에 대한 정보를 저장하는 문서이다.
- MCPTT Group 에 대한 각 Member List 및 Policy 정보를 저장한다.
4.4.2 코딩
- 7.7 group schema 참조
- 3.2.3.1 Group XML Document Sample 참조
4.4.3 Document 획득
- HTTP GET 메시지를 이용하며 HTTP URI는 Document Selector를 포함하여야 한다.
예) 
Request
GET /org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133 HTTP/1.1
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Intended-Identity: tel:+82510200011
Response
HTTP/1.1 200 OK 
Etag: “033ff287c5b548cb8a79655edf226de3"
Content-Type: application/vnd.oma.poc.groups+xml; charset="utf-8" 
<?xml version="1.0" encoding="UTF-8"?>
<group  xmlns="urn:oma:xml:poc:list-service"
  xmlns:rl="urn:ietf:params:xml:ns:resource-lists"
  xmlns:cp="urn:ietf:params:xml:ns:common-policy"
  xmlns:ocp="urn:oma:xml:xdm:common-policy"
  xmlns:oxe="urn:oma:xml:xdm:extensions"
  xmlns:mcpttgi="urn:3gpp:ns:mcpttGroupInfo:1.0"
  >
  <list-service uri="tel:+8293315310133">
    <display-name xml:lang="en-us">My Group display name</display-name>
    <list>
      <entry uri="tel:+82510200011">
        <rl:display-name>User 1001</rl:display-name>
        <mcpttgi:on-network-required/>
        <mcpttgi:user-priority>1</mcpttgi:user-priority>
      </entry>
      <entry uri="tel:+82510200012">
        <rl:display-name>User 1002</rl:display-name>
        <mcpttgi:on-network-required/>
        <mcpttgi:user-priority>2</mcpttgi:user-priority>
      </entry>
      <entry uri="tel:+82510200013">
        <rl:display-name>User 1003</rl:display-name>
        <mcpttgi:user-priority>3</mcpttgi:user-priority>
      </entry>
    </list>
    <mcpttgi:on-network-invite-members>true</mcpttgi:on-network-invite-members>
    <mcpttgi:on-network-max-participant-count>10</mcpttgi:on-network-max-participant-count>
    <cp:ruleset>
      <cp:rule id="a7c">
         <cp:actions>
          <mcpttgi:allow-MCPTT-emergency-call>true</mcpttgi:allow-MCPTT-emergency-call>
          <mcpttgi:allow-imminent-peril-call>true</mcpttgi:allow-imminent-peril-call>
          <mcpttgi:allow-MCPTT-emergency-alert>true</mcpttgi:allow-MCPTT-emergency-alert>
        </cp:actions>
      </cp:rule>
    </cp:ruleset>
    <oxe:supported-services>
     <oxe:service enabler="example.mcptt”>
      <oxe:group-media>
       <mcpttgi:mcptt-speech/>
      </oxe:group-media>
     </oxe:service>
    </oxe:supported-services>
    <mcpttgi:on-network-group-priority>5</mcpttgi:on-network-group-priority>
  </list-service>
</group>
4.4.4 Element 획득
- HTTP GET 메시지를 이용하며 HTTP URI는 Document Selector 및 Node Selector를 포함하여야 한다.
- MIME Type은 application/xcap-el+xml 이다.
예)
Request
GET /org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133/
~~/group/list-service%5b@uri=%22tel:+8293315310133%22%5d/display-name
Host: csc.mcptt.com
access_token: eyJhbGciOiJSUzI1NiJ9.eyJtY3B0dF9pZCI6InRlbDorODI1MDEwMjAxMjMiLCJhdWQiOiJtY3B0dF9jbGllbnQiLCJleHAiOjE0OTM5NjU4MjksInNjb3BlIjpbIm9wZW5pZCIsIjNncHA6bWNwdHQ6cHR0X3NlcnZlciJdfQ.fj52cilAMBjlB1zg-zZ7_zcXOlJKJGqt1caz0FlpbNM2q-txWhT0LAMuCia0fNmmjVfTUqjek9zeIqHpdya9i1fTBPeF0VcztyDPSukIAex4oAfT8x6vMuP8W5kmgu2oPxu_C3g-lK81ART7_U96Hefanl3tvzxtMEtdSENjVCsLiWWSyxllIyfhRokz89k7nyJjZ7hRajU6qvn0NGYjUG6JvkCzHa3_UEhmQQQvE6l4HMaqLhlyUpstSQvBkJ7SGQz9maKOEiI5bPai0eT7Qw_Lf8n4FsQktFbjNFOi1cHzWkmNzYfreeKe_36Zu4uaS88I0EvCteQnBNM7fbmoRw
X-3GPP-Intended-Identity: tel:+82510200011
Content-Type: application/xcap-el+xml
Response
HTTP/1.1 200 OK
Etag: " UUrfba7Qpif15LiChpkxNCGp0AJGgFYA "
Content-Type: application/xcap-el+xml
<display-name xml:lang="en-us">My conference display name</display-name>
4.5 Document subscription 및 notification
4.5.1 일반
- CSC에서 관리하고 있는 XUI에 해당하는 모든 문서의 변경상태를 구독
- 아래와 같은 문서의 변경상태를 제공
org.3gpp.mcptt.ue-config
org.3gpp.mcptt.user-profile
org.3gpp.mcptt.service-config
org.openmobilealliance.groups
4.5.2 코딩
- resource-lists의 문서 구조는 아래와 같다.
<resource-lists> root element 
a) <list> 1개 이상 element: 구독하고자 하는 entry 정보
<entry> element
a) uri 속성: 해당 문서의 uri
- xcap-diff의 문서 구조는 아래와 같다.
<xcap-diff> 1개 이상 element 
a) xcap-root 속성: root uri 정보
<document> element
a) new-etag 속성: 해당 문서의 현재 etag
b) previous-etag 속성: 해당 문서의 과거 etag
c) sel 속성: 해당 문서의 uri
4.5.3 Initial Subscription
Subscription 은 CMS, GMS 로 각각도 가능하고, CSC 로 CMS 과 GMS 로 한 번에 할 수 있다.
Subscribe Request to CMS
SUBSCRIBE sip:cms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0
Expires: 3600
P-Asserted-Identity: tel:+82510200011
Accept: application/xcap-diff+xml
Event: xcap-diff
Content-Type: application/resource-lists+xml;charset="utf-8"
Content-Length: (…)
…
<?xml version="1.0" encoding="UTF-8"?>
<resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists">
    <list>
        <entry uri="org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile"/>
        <entry uri="org.3gpp.mcptt.service-config /users/tel:+82510200011/service-config "/>
</list>
</resource-lists>
Subscribe Request to GMS
SUBSCRIBE sip:gms_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0
Expires: 3600
P-Asserted-Identity: tel:+82510200011
Accept: application/xcap-diff+xml
Event: xcap-diff
Content-Type: application/resource-lists+xml;charset="utf-8"
Content-Length: (…)
…
<?xml version="1.0" encoding="UTF-8"?>
<resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists">
    <list>
<entry uri="org.openmobilealliance.groups/users/tel:+82510200011/"/>
</list>
</resource-lists>
Subscribe Request to CSC (CMS and GMS)
SUBSCRIBE sip:csc_psi@ptt.mnc031.mcc450.3gppnetwork.org SIP/2.0
Expires: 3600
P-Asserted-Identity: tel:+82510200011
Accept: application/xcap-diff+xml
Event: xcap-diff
Content-Type: application/resource-lists+xml;charset="utf-8"
Content-Length: (…)
…
<?xml version="1.0" encoding="UTF-8"?>
<resource-lists xmlns="urn:ietf:params:xml:ns:resource-lists">
    <list>
        <entry uri="org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile"/>
        <entry uri="org.3gpp.mcptt.service-config /users/tel:+82510200011/service-config "/>
        <entry uri="org.openmobilealliance.groups/users/tel:+82510200011"/>
</list>
</resource-lists>
Subscribe Response
SIP/2.0 200 OK
Expires: 3600
Content-Length: 0
…
Initial Notify Request
NOTIFY sip:+82510200011@pslte-demo.com SIP/2.0
Subscription-State: active;expires=3600
Event: xcap-diff
Content-Type: application/xcap-diff+xml;charset="utf-8"
Content-Length: (…)
…
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://csc.mcptt.com/">
  <document new-etag="1428035570" sel="org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile"/>
  <document new-etag="1361156489" sel="org.3gpp.mcptt.service-config /users/tel:+82510200011/service-config"/>
  <document new-etag="a361156483" sel="org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310133"/>
  <document new-etag="a361156484" sel="org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310134"/>
  <document new-etag="a361156485" sel="org.openmobilealliance.groups/users/tel:+82510200011/tel:+8293315310135"/>
</xcap-diff>
Notify Response
SIP/2.0 200 OK
Content-Length: 0
…
4.5.4 Notification
Notify Request
NOTIFY sip:+82510200011@pslte-demo.com SIP/2.0
Subscription-State: active;expires=3000
Event: xcap-diff
Content-Type: application/xcap-diff+xml;charset="utf-8"
Content-Length: (…)
…
<?xml version="1.0" encoding="UTF-8"?>
<xcap-diff xmlns="urn:ietf:params:xml:ns:xcap-diff" xcap-root="http://csc.mcptt.com/">
  <document previous-etag="1428035570" sel="org.3gpp.mcptt.user-profile/users/tel:+82510200011/user-profile" new-etag="a428035570"/>
</xcap-diff>
Notify Response
SIP/2.0 200 OK
Content-Length: 0
…
5. XML schema
5.1 xcapDirectory
5.2 resource Lists
5.3 xdm_extensions
5.4 rsrclst_uriusage
5.5 commonPolicy
5.6 mcpttgi extensions
5.7 group
5.8 User profile
5.9 Service Configuration
